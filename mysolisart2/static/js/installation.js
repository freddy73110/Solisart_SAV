var config = { "srv_name": "gestion.solisart.fr", "srv_req": "", "serial": "SC1Z20164105", "srv_id": "REYC", "srv_port": "80", "req_T": "30", "TMarcheDeg": "105", "DTChrgBallon": "30", "Type_Appr(0)": "0", "Type_Appr(1)": "0", "Type_Appr(2)": "0", "Dephas(0)": "0", "Dephas(1)": "0", "Dephas(2)": "0", "DTDebChauf(0)": "0", "DTDebChauf(1)": "0", "DTDebChauf(2)": "0", "BesMaxChauf(0)": "0", "BesMaxChauf(1)": "0", "BesMaxChauf(2)": "0", "RecPrd": "30", "Type_Ballon_C": "1", "Type_Ballon_S": "0", "TMaxECSA": "95", "TMaxECSS": "95", "TMaxECSC": "110", "TBasculECS": "55", "DTCapteurOn": "10", "DTCapteurOff": "4", "VMinCircCapteur": "50", "Nb_Champs_Capt": "2", "Sortie_48": "255", "Sortie_49": "255", "S48lbl": "Sortie", "S49lbl": "Sortie", "Type_Appoint(0)": "3", "Type_Appoint(1)": "0", "TMaxApp(0)": "92", "TMaxApp(1)": "100", "TRetMinChdr(0)": "35", "TRetMinChdr(1)": "47", "DTChdr(0)": "20", "DTChdr(1)": "7", "DTAppECS(0)": "6", "DTAppECS(1)": "6", "TStockECS(0)": "42", "TStockECS(1)": "42", "ZoneAppoint(0)": "2", "ZoneAppoint(1)": "2", "MinOnDelay(0)": "20", "MinOnDelay(1)": "5", "MinOffDelay(0)": "1", "MinOffDelay(1)": "1", "VolCorpsChf(0)": "10", "VolCorpsChf(1)": "10", "VMinCircApp(0)": "100", "VMinCircApp(1)": "100", "NonRecupCal(0)": "", "NonRecupCal(1)": "", "tlbl(11)": "RDC", "tlbl(12)": "ETAGE", "tlbl(13)": "Piscine", "tlbl(14)": "", "Type_Emetteur(0)": "1", "Type_Emetteur(1)": "2", "Type_Emetteur(2)": "4", "Type_Emetteur(3)": "0", "Type_Emetteur(4)": "0", "Type_Emetteur(5)": "0", "DTMaxSol(0)": "3.0", "DTMaxSol(1)": "3.0", "DTMaxSol(2)": "0.0", "DTMaxSol(3)": "0.0", "DTMaxSol(4)": "3.0", "DTMaxSol(5)": "3.0", "DTEco(0)": "4", "DTEco(1)": "7", "DTEco(2)": "0", "DTEco(3)": "0", "DTEco(4)": "7", "DTEco(5)": "7", "DTOn(0)": "5", "DTOn(1)": "5", "DTOn(2)": "0", "DTOn(3)": "0", "DTOn(4)": "5", "DTOn(5)": "5", "DTOff(0)": "2", "DTOff(1)": "2", "DTOff(2)": "0", "DTOff(3)": "0", "DTOff(4)": "2", "DTOff(5)": "2", "DTCorrTA(0)": "0.0", "DTCorrTA(1)": "0.0", "DTCorrTA(2)": "0.0", "DTCorrTA(3)": "0.0", "DTCorrTA(4)": "0.0", "DTCorrTA(5)": "0.0", "TBaseEnvoi(0)": "37", "TBaseEnvoi(1)": "55", "TBaseEnvoi(2)": "0", "TBaseEnvoi(3)": "0", "TBaseEnvoi(4)": "55", "TBaseEnvoi(5)": "55", "TMinEnvoi(0)": "27", "TMinEnvoi(1)": "30", "TMinEnvoi(2)": "0", "TMinEnvoi(3)": "0", "TMinEnvoi(4)": "27", "TMinEnvoi(5)": "27", "TMaxEnvoi(0)": "38", "TMaxEnvoi(1)": "65", "TMaxEnvoi(2)": "0", "TMaxEnvoi(3)": "0", "TMaxEnvoi(4)": "65", "TMaxEnvoi(5)": "65", "TBaseExt(0)": "-10", "DTOffset": "0.0", "UUs": "util", "UPw": "util", "Usr(0)": "util1", "Mdp(0)": "util1", "Usr(1)": "util2", "Mdp(1)": "util2", "Usr(2)": "util3", "Mdp(2)": "util3", "Usr(3)": "util4", "Mdp(3)": "util4", "Usr(4)": "util5", "Mdp(4)": "util5", "Usr(5)": "util6", "Mdp(5)": "util6", "THorsGel": "10", "Mode_Hors_Gel": "", "DateDebHorsGel(0)": "4", "DateDebHorsGel(1)": "3", "DateDebHorsGel(2)": "24", "DateDebHorsGel(3)": "20", "DateFinHorsGel(0)": "4", "DateFinHorsGel(1)": "3", "DateFinHorsGel(2)": "24", "DateFinHorsGel(3)": "20", "Mode_Chauff(0)": "2", "Mode_Chauff(1)": "1", "Mode_Chauff(2)": "0", "Mode_Chauff(3)": "0", "Mode_Chauff(4)": "0", "Mode_Chauff(5)": "0", "Mode_Chauff(6)": "2", "TConfort(0)": "22.0", "TConfort(1)": "21.0", "TConfort(2)": "20.0", "TConfort(3)": "20.0", "TConfort(4)": "20.0", "TConfort(5)": "20.0", "TConfort(6)": "42.0", "TReduit(0)": "22.0", "TReduit(1)": "19.0", "TReduit(2)": "18.0", "TReduit(3)": "18.0", "TReduit(4)": "18.0", "TReduit(5)": "18.0", "TReduit(6)": "37.0", "DTDerog(0)": "0", "DTDerog(1)": "0", "DTDerog(2)": "0", "DTDerog(3)": "0", "DTDerog(4)": "0", "DTDerog(5)": "0", "DTDerog(6)": "0", "Mode_Derog(0)": "", "Mode_Derog(1)": "", "Mode_Derog(2)": "", "Mode_Derog(3)": "", "Mode_Derog(4)": "", "Mode_Derog(5)": "", "Mode_Derog(6)": "", "TPiscine": "30", "PriorAppoint1": "", "CacS48": "", "CacS49": "", "P(0,0,0)": "0", "P(0,0,1)": "240", "P(0,0,2)": "255", "P(0,0,3)": "255", "P(0,0,4)": "255", "P(0,0,5)": "255", "P(0,1,0)": "0", "P(0,1,1)": "240", "P(0,1,2)": "255", "P(0,1,3)": "255", "P(0,1,4)": "255", "P(0,1,5)": "255", "P(0,2,0)": "0", "P(0,2,1)": "240", "P(0,2,2)": "255", "P(0,2,3)": "255", "P(0,2,4)": "255", "P(0,2,5)": "255", "P(0,3,0)": "0", "P(0,3,1)": "240", "P(0,3,2)": "255", "P(0,3,3)": "255", "P(0,3,4)": "255", "P(0,3,5)": "255", "P(0,4,0)": "0", "P(0,4,1)": "240", "P(0,4,2)": "255", "P(0,4,3)": "255", "P(0,4,4)": "255", "P(0,4,5)": "255", "P(0,5,0)": "0", "P(0,5,1)": "240", "P(0,5,2)": "255", "P(0,5,3)": "255", "P(0,5,4)": "255", "P(0,5,5)": "255", "P(0,6,0)": "0", "P(0,6,1)": "240", "P(0,6,2)": "255", "P(0,6,3)": "255", "P(0,6,4)": "255", "P(0,6,5)": "255", "P(1,0,0)": "0", "P(1,0,1)": "240", "P(1,0,2)": "255", "P(1,0,3)": "255", "P(1,0,4)": "255", "P(1,0,5)": "255", "P(1,1,0)": "0", "P(1,1,1)": "240", "P(1,1,2)": "255", "P(1,1,3)": "255", "P(1,1,4)": "255", "P(1,1,5)": "255", "P(1,2,0)": "0", "P(1,2,1)": "240", "P(1,2,2)": "255", "P(1,2,3)": "255", "P(1,2,4)": "255", "P(1,2,5)": "255", "P(1,3,0)": "0", "P(1,3,1)": "240", "P(1,3,2)": "255", "P(1,3,3)": "255", "P(1,3,4)": "255", "P(1,3,5)": "255", "P(1,4,0)": "0", "P(1,4,1)": "240", "P(1,4,2)": "255", "P(1,4,3)": "255", "P(1,4,4)": "255", "P(1,4,5)": "255", "P(1,5,0)": "0", "P(1,5,1)": "240", "P(1,5,2)": "255", "P(1,5,3)": "255", "P(1,5,4)": "255", "P(1,5,5)": "255", "P(1,6,0)": "0", "P(1,6,1)": "240", "P(1,6,2)": "255", "P(1,6,3)": "255", "P(1,6,4)": "255", "P(1,6,5)": "255", "P(2,0,0)": "0", "P(2,0,1)": "240", "P(2,0,2)": "255", "P(2,0,3)": "255", "P(2,0,4)": "255", "P(2,0,5)": "255", "P(2,1,0)": "0", "P(2,1,1)": "240", "P(2,1,2)": "255", "P(2,1,3)": "255", "P(2,1,4)": "255", "P(2,1,5)": "255", "P(2,2,0)": "0", "P(2,2,1)": "240", "P(2,2,2)": "255", "P(2,2,3)": "255", "P(2,2,4)": "255", "P(2,2,5)": "255", "P(2,3,0)": "0", "P(2,3,1)": "240", "P(2,3,2)": "255", "P(2,3,3)": "255", "P(2,3,4)": "255", "P(2,3,5)": "255", "P(2,4,0)": "0", "P(2,4,1)": "240", "P(2,4,2)": "255", "P(2,4,3)": "255", "P(2,4,4)": "255", "P(2,4,5)": "255", "P(2,5,0)": "0", "P(2,5,1)": "240", "P(2,5,2)": "255", "P(2,5,3)": "255", "P(2,5,4)": "255", "P(2,5,5)": "255", "P(2,6,0)": "0", "P(2,6,1)": "240", "P(2,6,2)": "255", "P(2,6,3)": "255", "P(2,6,4)": "255", "P(2,6,5)": "255", "P(3,0,0)": "0", "P(3,0,1)": "240", "P(3,0,2)": "255", "P(3,0,3)": "255", "P(3,0,4)": "255", "P(3,0,5)": "255", "P(3,1,0)": "0", "P(3,1,1)": "240", "P(3,1,2)": "255", "P(3,1,3)": "255", "P(3,1,4)": "255", "P(3,1,5)": "255", "P(3,2,0)": "0", "P(3,2,1)": "240", "P(3,2,2)": "255", "P(3,2,3)": "255", "P(3,2,4)": "255", "P(3,2,5)": "255", "P(3,3,0)": "0", "P(3,3,1)": "240", "P(3,3,2)": "255", "P(3,3,3)": "255", "P(3,3,4)": "255", "P(3,3,5)": "255", "P(3,4,0)": "0", "P(3,4,1)": "240", "P(3,4,2)": "255", "P(3,4,3)": "255", "P(3,4,4)": "255", "P(3,4,5)": "255", "P(3,5,0)": "0", "P(3,5,1)": "240", "P(3,5,2)": "255", "P(3,5,3)": "255", "P(3,5,4)": "255", "P(3,5,5)": "255", "P(3,6,0)": "0", "P(3,6,1)": "240", "P(3,6,2)": "255", "P(3,6,3)": "255", "P(3,6,4)": "255", "P(3,6,5)": "255", "P(4,0,0)": "0", "P(4,0,1)": "240", "P(4,0,2)": "255", "P(4,0,3)": "255", "P(4,0,4)": "255", "P(4,0,5)": "255", "P(4,1,0)": "0", "P(4,1,1)": "240", "P(4,1,2)": "255", "P(4,1,3)": "255", "P(4,1,4)": "255", "P(4,1,5)": "255", "P(4,2,0)": "0", "P(4,2,1)": "240", "P(4,2,2)": "255", "P(4,2,3)": "255", "P(4,2,4)": "255", "P(4,2,5)": "255", "P(4,3,0)": "0", "P(4,3,1)": "240", "P(4,3,2)": "255", "P(4,3,3)": "255", "P(4,3,4)": "255", "P(4,3,5)": "255", "P(4,4,0)": "0", "P(4,4,1)": "240", "P(4,4,2)": "255", "P(4,4,3)": "255", "P(4,4,4)": "255", "P(4,4,5)": "255", "P(4,5,0)": "0", "P(4,5,1)": "240", "P(4,5,2)": "255", "P(4,5,3)": "255", "P(4,5,4)": "255", "P(4,5,5)": "255", "P(4,6,0)": "0", "P(4,6,1)": "240", "P(4,6,2)": "255", "P(4,6,3)": "255", "P(4,6,4)": "255", "P(4,6,5)": "255", "P(5,0,0)": "0", "P(5,0,1)": "240", "P(5,0,2)": "255", "P(5,0,3)": "255", "P(5,0,4)": "255", "P(5,0,5)": "255", "P(5,1,0)": "0", "P(5,1,1)": "240", "P(5,1,2)": "255", "P(5,1,3)": "255", "P(5,1,4)": "255", "P(5,1,5)": "255", "P(5,2,0)": "0", "P(5,2,1)": "240", "P(5,2,2)": "255", "P(5,2,3)": "255", "P(5,2,4)": "255", "P(5,2,5)": "255", "P(5,3,0)": "0", "P(5,3,1)": "240", "P(5,3,2)": "255", "P(5,3,3)": "255", "P(5,3,4)": "255", "P(5,3,5)": "255", "P(5,4,0)": "0", "P(5,4,1)": "240", "P(5,4,2)": "255", "P(5,4,3)": "255", "P(5,4,4)": "255", "P(5,4,5)": "255", "P(5,5,0)": "0", "P(5,5,1)": "240", "P(5,5,2)": "255", "P(5,5,3)": "255", "P(5,5,4)": "255", "P(5,5,5)": "255", "P(5,6,0)": "0", "P(5,6,1)": "240", "P(5,6,2)": "255", "P(5,6,3)": "255", "P(5,6,4)": "255", "P(5,6,5)": "255", "P(6,0,0)": "0", "P(6,0,1)": "240", "P(6,0,2)": "255", "P(6,0,3)": "255", "P(6,0,4)": "255", "P(6,0,5)": "255", "P(6,1,0)": "0", "P(6,1,1)": "240", "P(6,1,2)": "255", "P(6,1,3)": "255", "P(6,1,4)": "255", "P(6,1,5)": "255", "P(6,2,0)": "0", "P(6,2,1)": "240", "P(6,2,2)": "255", "P(6,2,3)": "255", "P(6,2,4)": "255", "P(6,2,5)": "255", "P(6,3,0)": "0", "P(6,3,1)": "240", "P(6,3,2)": "255", "P(6,3,3)": "255", "P(6,3,4)": "255", "P(6,3,5)": "255", "P(6,4,0)": "0", "P(6,4,1)": "240", "P(6,4,2)": "255", "P(6,4,3)": "255", "P(6,4,4)": "255", "P(6,4,5)": "255", "P(6,5,0)": "0", "P(6,5,1)": "240", "P(6,5,2)": "255", "P(6,5,3)": "255", "P(6,5,4)": "255", "P(6,5,5)": "255", "P(6,6,0)": "0", "P(6,6,1)": "240", "P(6,6,2)": "255", "P(6,6,3)": "255", "P(6,6,4)": "255", "P(6,6,5)": "255", "firmware_rev": "SRB_32MX_vD.46-5", "web_rev": "WEB_vA.98", "config_mac": "00", "ip(0)": "192", "ip(1)": "168", "ip(2)": "1", "ip(3)": "103", "sub(0)": "255", "sub(1)": "255", "sub(2)": "255", "sub(3)": "0", "gw(0)": "192", "gw(1)": "168", "gw(2)": "1", "gw(3)": "1", "pdn(0)": "8", "pdn(1)": "8", "pdn(2)": "8", "pdn(3)": "8", "sdn(0)": "8", "sdn(1)": "8", "sdn(2)": "4", "sdn(3)": "4", "tlbl(01)": "Capt", "tlbl(09)": "Exterieure", "tlbl(02)": "Capt", "tlbl(10)": "", "tlbl(03)": "Ballon", "tlbl(04)": "Ballon", "tlbl(05)": "", "tlbl(06)": "", "tlbl(07)": "Chaudiere", "tlbl(15)": "", "tlbl(08)": "Chaudiere", "tlbl(16)": "", "fllbl(1)": "", "fllbl(2)": "", "fllbl(3)": "", "fllbl(4)": "", "fllbl(5)": "", "fllbl(6)": "", "trilbl(01)": "Circ", "trilbl(08)": "V3V", "trilbl(02)": "CIRC", "trilbl(09)": "V3V", "trilbl(03)": "", "trilbl(10)": "", "trilbl(04)": "", "trilbl(11)": "", "trilbl(05)": "CIRC", "trilbl(12)": "", "trilbl(06)": "CIRC", "trilbl(13)": "", "trilbl(07)": "", "ModeleDebitmetre(0)": "0", "ModeleDebitmetre(1)": "0", "ModeleDebitmetre(2)": "0", "ModeleDebitmetre(3)": "0", "ModeleDebitmetre(4)": "0", "t(1)": "38.7", "t(2)": "25.7", "t(3)": "29.3", "t(4)": "43.4", "t(5)": "Dsc", "t(6)": "Dsc", "t(7)": "25.8", "t(8)": "34.3", "t(9)": "11.9", "t(10)": "Dsc", "t(11)": "23.2", "t(12)": "20.9", "t(13)": "Dsc", "t(14)": "Dsc", "t(15)": "Dsc", "t(16)": "Dsc", "fl(1)": "0.0", "fl(2)": "0.0", "fl(3)": "0.0", "fl(4)": "0.0", "fl(5)": "-0.0", "fl(6)": "Off", "rl(0)": "Off", "rl(4)": "Off", "tr(1)": "0pC", "tr(2)": "0pC", "tr(3)": "50pC", "tr(4)": "80pC", "tr(5)": "0pC", "tr(6)": "96pC", "tr(7)": "0pC", "tr(8)": "0pC", "tr(9)": "0pC", "tr(10)": "0pC", "tr(11)": "33pC", "tr(12)": "0pC", "tr(13)": "0pC", "v3v(0)": "0", "v3v(1)": "0", "v3v(2)": "28", "flpws": "1", "Tcons(0)": "22.0", "Tcons(1)": "21.0", "Tcons(2)": "31.7", "Tcons(3)": "7.0", "Tcons(6)": "42.0", "Dem(0)": "1", "Dem(1)": "2", "Dem(2)": "0", "Dem(3)": "82", "Dem(6)": "0", "MD": "-38.1", "dtcapt3mn": "0.0", "TconPisc_dep": "30", "Tcaptcalc": "38.7", "anticc_chd": "520.0", "var_cir": "0.0", "demPisc_D": "108", "def_T": "0", "def": "0", "CircType(0)": "0", "CircType(1)": "0", "CircType(2)": "0", "CircType(3)": "0", "CircType(4)": "0", "CircType(5)": "0", "CircType(6)": "0", "CircType(9)": "0", "CircType(10)": "0", "tfmoy": "0", "index1": "-0.0", "index2": "0.0", "index3": "0.0", "index4": "0.0", "index5": "37.1", "index6": "35.6", "index1S": "-0.0", "index2S": "0.0", "index3S": "-0.0", "index4S": "0.0", "index5S": "38.7", "index6S": "0.0", "rebour_derog_z1": "0", "rebour_derog_z2": "0", "rebour_derog_z3": "0", "rebour_derog_z4": "0", "rebour_derog_z5": "0", "rebour_derog_z6": "0", "rebour_derog_ECS": "0", "CarteCompteur": "40929", "ServeurCompteur": "40964"}

//Démarrer chorme avec win+R
//chrome.exe --user-data-dir="C://User//freddy//PycharmProjects//Maquette ouverture my.solisart.fr" --disable-web-security

$("#allcharts").hide()
$("#inputLinkConfig").on("change", function(e){
    var file = e.target.files[0]
    var reader = new FileReader();
   reader.readAsText(file,'UTF-8');

   // here we tell the reader what to do when it's done reading...
   reader.onload = readerEvent => {
      var csv = readerEvent.target.result; // this is the content!
      const lines = csv.split("\n");
        data = {}
        
        lines.forEach(line => {
            data[line.split(';')[1]] = line.split(';')[2]
        });
      refresh(data)
   }
})


function reloadjson(url){
    if(!url){
        var url = '../static/file/config.csv'
    }
    const xhr = new XMLHttpRequest();
    xhr.open('GET', url);
    xhr.onload = function() {
    if (xhr.status === 200) {
            var csv = xhr.responseText;
            const lines = csv.split("\n");
            data = {}            
            lines.forEach(line => {
                data[line.split(';')[1]] = line.split(';')[2]
            });
        refresh(data)
        $(".T11").parent().click()      
        } else {
        console.error('Erreur lors du chargement du fichier JSON');
        }
    };
    xhr.send()

}

reloadjson()

Type_Emetteur=['Aucun', 'Plancher Chauffant', 'Radiateur', 'Piscine', 'Ventillo-Convecteur', 'Décharge', 'Radiateur en réhausse']
Dem = ["", '<i class="far fa-sun fa-beat-fade text-warning"></i>', '<i class="fas fa-battery-three-quarters fa-beat-fade text-warning"></i>', '<i class="fas fa-shower fa-beat-fade"></i>', '<i class="fa-solid fa-fire fa-beat-fade text-warning"></i>']
APP1 = ["Aucun", "Gaz/Fioul", "Chaud Condensation", "Electrique", "PAC", "Granulé", "Bois", "Elec ESC Seul", "ON si APP2 HS"]
APP2 = ["Aucun", "", "", "", "", "Granulé", "Bois", "ECS Appoint 1", "Cascade appoint 1", "On si App1 en défaut"]
ZoneAppoint = ["Aucun", "Zone 1", "Zone 2", "Zone 3", "Zone 4", "APP2 prioritaire si pressostat ON", "T° Confort si pressostat ON et Réduit si OFF", "T° Confort si pressostat OFF et Réduit si ON"]
capteur = ["Aucun", "1 champ capteur", "2 champs en //", "2 champs en série", "1 champs découplé sur T16", "2 champs découplé sur T16"]
vitesseCirculateur= ["TRAD", "BC V1", "BC V2", "BC V3", "BC V4", "BC V5"]

function affichageTemperature(configInstantane,schemaID, champs, sonde){
    switch (configInstantane[champs].replace('dC', '')){
        case "Dsc":
            $("#"+schemaID).find("."+sonde).html("Sonde déconnectée")
            break;
        case "Cc":
            $("#"+schemaID).find("."+sonde).html("Sonde en court circuit")
        default:
            $("#"+schemaID).find("."+sonde).html(configInstantane[champs].replace('dC', '') + "°C")
    }
}

function affichageCirculateur(configInstantane, champs, circulateur){
    return configInstantane[champs].replace('F-', '').replace('pC', '%')
}

function animationSensor(configInstantane, schemaID){
    if (configInstantane['Type_Ballon_C'] == "1" &&  configInstantane['tr(3)'] != "0pC"){
        //Le tampon tire sur les capteurs
        $("#"+schemaID).find(".divCapteurs").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")                
        $("#"+schemaID).find(".divCapteurs").not(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animated")
        $("#"+schemaID).find(".divCapteurs").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
        $("#"+schemaID).find(".divCapteur2").not(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animated")        
        $("#"+schemaID).find(".divCapteurs2").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
        $("#"+schemaID).find(".divCapteur2").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")
    }
}

function parametreGeneraux(){
    $("#description").html("<h1 class='text-center'>Paramètres Généraux</h1>") 
    scrollToDescription()
    $("#parametreUtilisateur").html('')
    $("#parametreInstallateur").html('')
    paramInstall = '<fieldset class="border-top p-2 text-center"><legend class="float-none w-auto">Paramètre installateur</legend>'
        +'<div class="row">'
        +'<div class="col-6">'
        +'<div class="input-group mb-3">'
        +'<span class="input-group-text">'
        +'<i class="fas fa-temperature-high"></i>'
        +'</span>'
        +'<div class="form-floating">'
        +'<input type="number" step="1" class="form-control" value="'+data["TBaseExt(0)"]+'">'
        +'<label>Temp extérieure de base</label>'
        +'</div>'        
        +'<span class="input-group-text">°C</span>'
        +'</div></div>'
        +'<div class="col-6">'
        +'<div class="input-group mb-3">'
        +'<span class="input-group-text">'
        +'<i class="fas fa-temperature-high"></i>'
        +'</span>'
        +'<div class="form-floating">'
        +'<input type="number" step="1" class="form-control" value="'+data["DTOffset"]+'">'
        +'<label>Correction sondes</label>'
        +'</div>'        
        +'<span class="input-group-text" id="basic-addon1">°C</span>'
        +'</div>'
        +'</div></div></fieldset>'
    $("#parametreInstallateur").html(paramInstall)

}

function refresh(configInstantane, schemaID){
    
    if(schemaID === undefined){
        schemaID = "schema"
    }
    //Ajout bouton mode vacance et Animation
    $(".AddAvailable").html('<button class="btn btn-primary" id="vacances"><i class="fa-solid fa-suitcase-rolling"></i> Mode Vacances</button>')
    $(".AddAvailable").append('<button class="btn btn-primary m-3" onclick="parametreGeneraux()"><i class="fa-solid fa-gear"></i> Paramètres généraux</button>')
    if (parseFloat(configInstantane['MD'])>0){
        $("#"+schemaID).find(".MD").show()
    }else{
        $("#"+schemaID).find(".MD").hide()
    }
    if(schemaID == "schema"){
        $("#vacances").on("click", function(){
            $("#description").html("<h1 class='text-center'>Mode Vacances</h1>") 
            scrollToDescription()
            $("#parametreUtilisateur").html('')
            $("#parametreInstallateur").html('')
            htmlUtilisateur='<fieldset class="border-top p-2 text-center"><legend class="float-none w-auto">Paramètre utilisateur</legend>'
            +'<div class="col-12 col-lg-8 p-3 m-auto">'
            +'<div class="input-group mb-3"><div class="input-group-text">'
            +'<div class="form-check m-auto">'
            +'<input class="form-check-input mt-1" type="checkbox" id="horsGelCheck">'
            +'<label class="form-check-label" for="derogation">Mode Hors Gel</label>'
            +'</div></div>'
            +'<div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température de dérogation pendant 4 heures. Valable uniquement en appoint">'
            +'<input id="horsGel" type="number" step="1" min="0" max="4" class="form-control" value="'+data['THorsGel']+'"'
            if(data['Mode_Hors_Gel'] =="0"){
                htmlUtilisateur+= " disabled>"
            }else{
                htmlUtilisateur+= ">"
            }
            htmlUtilisateur+='<label>Hors gel</label>'
            +'</div>'
            +'<span class="input-group-text">°C</span>'
            +'</div></div>'
            +'</div>'
            +'<div class="col-12 col-lg-8 p-3 m-auto">'
            +'<div class="input-group mb-3">'
            +'<span class="input-group-text"><i class="fa-regular fa-calendar"></i></span>'
            +'<div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température de dérogation pendant 4 heures. Valable uniquement en appoint">'
            +'<input id="horsGelDebut" type="text" class="form-control datepicker" value="'+data['DateDebHorsGel(0)']+'/'+data['DateDebHorsGel(1)']+'/20'+data['DateDebHorsGel(2)']+' '+data['DateDebHorsGel(3)']+':00">'
            +'<label>Début</label>'
            +'</div>'
            +'<div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température de dérogation pendant 4 heures. Valable uniquement en appoint">'
            +'<input id="horsGelFin" type="text" class="form-control datepicker" value="'+data['DateFinHorsGel(0)']+'/'+data['DateFinHorsGel(1)']+'/20'+data['DateFinHorsGel(2)']+' '+data['DateFinHorsGel(3)']+':00">'
            +'<label>Fin</label>'
            +'</div>'
            +'</div>'
            +'</fieldset>'
            $("#parametreUtilisateur").html(htmlUtilisateur)
            $( ".datepicker" ).datetimepicker({
                    minDate:new Date(),
                    format:'d/m/Y  H:i',
                    allowTimes:['00:00', '01:00', '02:00', '03:00', '04:00', '05:00', '06:00',
                    '07:00', '08:00', '09:00', '10:00', '11:00', '12:00',
                    '13:00', '14:00', '15:00', '16:00', '17:00', '18:00',
                    '19:00', '20:00', '21:00', '22:00', '23:00'
                    ]
            });
            if (data["Mode_Hors_Gel"] == ""){
                $("#horsGelFin,#horsGelDebut,#horsGel").prop('disabled', true)
            }
            $("#horsGelCheck").on("click", function(){
                $("#horsGelFin,#horsGelDebut, #horsGel").prop('disabled', (i, v) => !v)
            })
        });
        //A supprimer
        $(".AddAvailable").append('<button class="btn btn-success m-3" onclick="reloadjson()">Rafraichir</button>')
        //Nommer l'installation
        $("#installationName").html('Installation ' + configInstantane.serial + ' <br> ' + configInstantane.srv_id)
        //Affichage Ballon tampon
    }
    //Supprime toutes les animations
    $("#"+schemaID).find(".progress-bar").removeClass("bg-danger progress-bar-striped progress-bar-animated bg-warning progress-bar-animatedreserve")
    $("#"+schemaID).find(".fa-circle-play").removeClass("fa-spin")
    $("#"+schemaID).find(".fillBallon").removeClass("fillBallon").addClass("standbyeBallon")
    
    if(configInstantane['Type_Ballon_C'] == "0"){
        $("#"+schemaID).find(".divTampon").hide()
        $(".AddAvailable").append('<button class="btn btn-primary"><i class="fas fa-plus-circle"></i> Ballon tampon</button>')
    }else{
        $("#"+schemaID).find(".divTampon").show()
        if(configInstantane['tr(3)']=="0pC"){
            var htmlC6 = '<i class="fa-solid fa-circle-play fa-2x"></i>'
        }else{
            var htmlC6 = '<i class="fa-solid fa-circle-play fa-spin fa-2x"></i><span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-secondary">'+ affichageCirculateur(configInstantane, 'tr(3)', 'C6') +'</span>'
        }        
        $("#"+schemaID).find(".C6").html(htmlC6)
        affichageTemperature(configInstantane, schemaID, 't(5)', "T5")
        
        if(configInstantane['tr(3)']!="0pC"){
            $("#"+schemaID).find(".progressC6").addClass("progress-bar-striped progress-bar-animated")
            $("#"+schemaID).find('.tampon').addClass("fillBallon")
            $("#"+schemaID).find (".exitTampon").addClass("bg-danger progress-bar-striped progress-bar-animated")  
            $("#"+schemaID).find(".divCapteurs, .divDecouplagePrimaire").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")
            $("#"+schemaID).find(".divDecouplagePrimaire").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
            $("#"+schemaID).find(".divCapteurs").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
            $("#"+schemaID).find(".divCapteurs").not(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animated")
            $("#"+schemaID).find(".divTampon").find(".vertical").find(".CF").eq(1).addClass("progress-bar-striped progress-bar-animatedreserve")
            $("#"+schemaID).find(".divTampon").find(".vertical").find(".CF").eq(0).addClass("progress-bar-striped progress-bar-animatedreserve")
            $("#"+schemaID).find(".divTampon").find(".vertical").find(".CC").eq(0).addClass("bg-danger progress-bar-striped progress-bar-animated")
        }
    }
    //Affichage v3v tampon
    switch(configInstantane['v3v(0)']){        
        case "0":
            $("#"+schemaID).find(".v3vSol").find(".fa-play").show()
            $("#"+schemaID).find(".v3vSol").find(".fa-play:eq(0), .fa-play:eq(3)").hide()
            break;
        case "100":
            $("#"+schemaID).find(".v3vSol").find(".fa-play").show()
            $("#"+schemaID).find(".v3vSol").find(".fa-play:eq(1), .fa-play:eq(3)").hide()
            break;
        default :
            $("#"+schemaID).find(".v3vSol").find(".fa-play").show()
            $("#"+schemaID).find(".v3vSol").find(".fa-play:eq(0), .fa-play:eq(1)").hide()
            break;
    }
    //Affichage Capteur
    switch(configInstantane.Nb_Champs_Capt){
        case '0':
            //Aucun 
            $("#"+schemaID).find(".divCapteurs, .divDecouplagePrimaire").hide()  
            var str = '$(".fa-solar-panel").click()'         
            $(".AddAvailable").append('<button class="btn btn-primary m-3" onclick='+str +'><i class="fas fa-plus-circle"></i> Capteurs</button>')
            break;
        case '1':
            //1 champ capteurs
            $("#"+schemaID).find(".divCapteurs, .divCapteur1").show()
            $("#"+schemaID).find(".divCapteur2, .divS10Capteur, .divV3VCapteur,.divS11Capteur, .divDecouplagePrimaire, .divT10Capteur1").hide() 
            affichageTemperature(configInstantane,schemaID,  't(1)', 'T1')
            affichageTemperature(configInstantane,schemaID, 't(9)', 'T9') 
            animationSensor(configInstantane)         
            break;
        case '2':
            //2 champs capteurs en parallèle
            $("#"+schemaID).find(".divCapteurs, .divCapteur1, .divCapteur2").show()
            $("#"+schemaID).find(".divV3VCapteur, .divS10Capteur, .divS11Capteur, .divDecouplagePrimaire, .divT10Capteur1").hide()
            affichageTemperature(configInstantane,schemaID,  't(1)', 'T1')
            affichageTemperature(configInstantane,schemaID,  't(9)', 'T9')
            affichageTemperature(configInstantane,schemaID, 't(10)', 'T10') 
            animationSensor(configInstantane)
            break;
        case '3':
            //2 champs capteurs en série
            $("#"+schemaID).find(".divCapteurs, .divCapteur1, .divT10Capteur1").show()
            $("#"+schemaID).find(".divV3VCapteur, .divS10Capteur, .divCapteur2, .divS11Capteur, .divDecouplagePrimaire").hide()
            affichageTemperature(configInstantane,schemaID, 't(1)', 'T1')
            affichageTemperature(configInstantane,schemaID, 't(9)', 'T9')
            affichageTemperature(configInstantane,schemaID, 't(10)', 'T10')
            animationSensor(configInstantane)
            break;
        case '4':
            //1 champ capteurs découplé sur échangeur sur T16
            $("#"+schemaID).find(".divCapteurs, .divCapteur1, .divDecouplagePrimaire, .divS10Capteur").show()
            $("#"+schemaID).find(".divV3VCapteur, .divS10Capteur, .divT10Capteur1, .divCapteur2").hide()            
            affichageTemperature(configInstantane,schemaID,  't(1)', 'T1')
            affichageTemperature(configInstantane,schemaID, 't(9)', 'T9')
            //si S11 tourne
            if(configInstantane["tr(11)"]=="0pC"){
                var htmlS11 = '<i class="fa-solid fa-circle-play fa-2x">'
                $("#"+schemaID).find(".divS11Capteur").html(htmlS11)
            }else{
                $("#"+schemaID).find(".divCapteurs").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")                
                $("#"+schemaID).find(".divCapteurs").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreverse")
                $("#"+schemaID).find(".divCapteurs").find(".CC:first").addClass("bg-danger progress-bar-striped progress-bar-animated")
                $("#"+schemaID).find(".divCapteurs").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreverse")
                var htmlS11 = '<i class="fa-solid fa-circle-play fa-spin fa-2x"></i><span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-secondary">'+ affichageCirculateur(configInstantane, 'tr(11)', "S11") +'</span>'
                $("#"+schemaID).find(".divS11Capteur").html(htmlS11)
            }
            break;
        case '5':
            //2 champs capteurs découplés
            $("#"+schemaID).find(".divCapteurs, .divCapteur1, .divCapteur2 , .divDecouplagePrimaire, .divS10Capteur, .divS11Capteur").show()
            $("#"+schemaID).find(".divV3VCapteur, .divT10Capteur1").hide()
            affichageTemperature(configInstantane,schemaID, 't(9)', 'T9')
            if(configInstantane["tr(11)"]==0){
                //S11 ne tourne pas
                var htmlS11 = '<i class="fa-solid fa-circle-play fa-spin fa-2x">'
                $("#"+schemaID).find(".divS11Capteur").html(htmlS11)
            }else{
                //S11 tourne
                var htmlS11 = '<i class="fa-solid fa-circle-play fa-spin fa-2x"></i><span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-secondary">'+ affichageCirculateur(configInstantane, 'tr(11)', "S11") +'</span>'
                $("#"+schemaID).find(".divS11Capteur").html(htmlS11)
                $("#"+schemaID).find(".divCapteurs").find(".vertical").find(".CC:first").addClass("bg-danger progress-bar-striped progress-bar-animated")                
                $("#"+schemaID).find(".divCapteurs").find(".vertical").find(".CF:first").addClass("progress-bar-striped progress-bar-animated")
            }
            if(configInstantane["tr(10)"]==0){
                var htmlS10 = '<i class="fa-solid fa-circle-play fa-spin fa-2x">'
                $("#"+schemaID).find(".divS10Capteur").html(htmlS10)
            }else{
                var htmlS10 = '<i class="fa-solid fa-circle-play fa-spin fa-2x"></i><span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-secondary">'+ affichageCirculateur(configInstantane, 'tr(10)', "S10") +'</span>'
                $("#"+schemaID).find(".divS10Capteur").html(htmlS10)
                $("#"+schemaID).find(".divCapteurs").find(".vertical").find(".CC").eq(1).addClass("bg-danger progress-bar-striped progress-bar-animated")                
                $("#"+schemaID).find(".divCapteurs").find(".vertical").find(".CF").eq(1).addClass("progress-bar-striped progress-bar-animated")
                $("#"+schemaID).find(".divCapteur2").find(".CC").eq(1).addClass("bg-danger progress-bar-striped progress-bar-animated") 
                $("#"+schemaID).find(".divCapteur2").find(".CF").eq(1).addClass("progress-bar-striped progress-bar-animated")
            }
            break;
        default:
            break;
    }
    //Affichage Appoint 1
    if (configInstantane['Type_Appoint(0)'] == '0'){
        $(".appoint1").addClass("d-none").hide()        
        $(".AddAvailable").append('<button class="btn btn-primary m-3"><i class="fas fa-plus-circle"></i> Appoint 1</button>')
    }else{
        $("#"+schemaID).find(".appoint1").removeClass("d-none").show()
    }
        //Afficher les température
        affichageTemperature(configInstantane,schemaID, 't(4)', 'T4')
        affichageTemperature(configInstantane,schemaID, 't(3)', 'T3')
        affichageTemperature(configInstantane,schemaID, 't(7)', 'T7')
        affichageTemperature(configInstantane,schemaID, 't(8)', 'T8')
        affichageTemperature(configInstantane,schemaID, 't(10)', 'T10')
        affichageTemperature(configInstantane,schemaID, 't(16)', 'T16')
        //Affichage consigne et demande ballon ECS
        var htmlDemBallonSanitaire = '<span class="position-absolute badge rounded-pill bg-primary" style="top:-5%; left: 90%;">'
        if(["1", "2"].includes(configInstantane['Dem(6)'])){
            htmlDemBallonSanitaire+='<i class="fa-solid fa-fire fa-beat-fade text-warning"></i>'
        }
        //todo Affiché + DT ecs en fct de l'appoint
        htmlDemBallonSanitaire+=configInstantane['Tcons(6)']+ "°C "
        htmlDemBallonSanitaire+='</span>'
        $("#"+schemaID).find(".BallonSanitaire").html(htmlDemBallonSanitaire)
        //Affiche le type d'appoint et si allumé
        var html = APP1[parseInt(configInstantane['Type_Appoint(0)'])] +' '        
        if(configInstantane['rl(0)']== "On"){
            if(configInstantane['Type_Appoint(0)'] == "3"){
                html += ' <i class="fa-solid fa-bolt fa-x2 text-warning fa-beat-fade m-1"></i>'
            }else{
                html += ' <i class="fa-solid fa-fire fa-x2 text-warning fa-beat-fade m-1"></i>'
            }
        }
        $("#"+schemaID).find(".appoint1").html(html)
        //V3V Appoint
        switch(configInstantane['v3v(1)']){
            case "0":
                $("#"+schemaID).find(".v3vApp").find(".fa-play").show()
                $("#"+schemaID).find(".v3vApp").find(".fa-play:eq(0), .fa-play:eq(3)").hide()
                break;
            case "100":
                $("#"+schemaID).find(".v3vApp").find(".fa-play").show()
                $("#"+schemaID).find(".v3vApp").find(".fa-play:eq(1), .fa-play:eq(3)").hide()
                break;
            default :
                $("#"+schemaID).find(".v3vApp").find(".fa-play").show()
                $("#"+schemaID).find(".v3vApp").find(".fa-play:eq(0), .fa-play:eq(1)").hide()
                break;
        }
        
        //Si C4 tourne
        if (configInstantane['tr(1)'] != '0pC'){
            var htmlC4 = '<i class="fa-solid fa-circle-play fa-spin fa-2x"></i><span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-secondary">'+ affichageCirculateur(configInstantane, 'tr(1)', "C4") +'</span>'
            $("#"+schemaID).find(".C4").html(htmlC4)
            $("#"+schemaID).find(".C4CC").addClass("bg-danger progress-bar-striped progress-bar-animated")
            $("#"+schemaID).find(".C4CF").addClass("progress-bar-striped progress-bar-animated")         
            $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CC").eq(2).addClass("bg-danger progress-bar-striped progress-bar-animated")
            $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CF").eq(2).addClass("progress-bar-striped progress-bar-animatedreserve")
            $("#"+schemaID).find(".BallonSanitaire").addClass("fillBallon")
            if(configInstantane["v3v(1)"]=="100"){
                $("#"+schemaID).find(".divAppoint1").find(".progress-bar").addClass("progress-bar-striped progress-bar-animated")
                if(configInstantane['ZoneAppoint(0)']!= "0"){
                    $("#"+schemaID).find(".divAppoint1").find(".progress-bar").eq(1).addClass("bg-danger")
                }
            }else if(configInstantane["v3v(1)"]=="0"){
                if (configInstantane['v3v(0)'] == 0){
                    $("#"+schemaID).find(".divTampon").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
                    $("#"+schemaID).find(".divTampon").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")
                    $("#"+schemaID).find(".divCapteurs").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")                
                    $("#"+schemaID).find(".divCapteurs").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
                    $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")                
                    $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")                      
                    $("#"+schemaID).find(".divDecouplagePrimaire").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")                    
                    $("#"+schemaID).find(".divDecouplagePrimaire").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
                }else if (configInstantane['v3v(0)'] == "100"){
                    $("#"+schemaID).find(".divTampon").find(".vertical").find(".CF").eq(1).addClass(" progress-bar-striped progress-bar-animatedreserve")
                    $("#"+schemaID).find(".divTampon").find(".vertical").find(".CC").eq(1).addClass("bg-danger progress-bar-striped progress-bar-animated")                 
                    $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")                
                    $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")                  
                    $("#"+schemaID).find(".shuntC6").addClass("progress-bar-striped progress-bar-animatedreserve")
                    $("#"+schemaID).find(".progressC6").eq(1).addClass("progress-bar-striped progress-bar-animatedreserve")
                    $("#"+schemaID).find('.tampon').addClass("fillBallon")
                    $("#"+schemaID).find(".exitTampon").addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                }else{                        
                    $("#"+schemaID).find(".divTampon").find(".vertical").find(".CF").eq(1).addClass("progress-bar-striped progress-bar-animated")
                    $("#"+schemaID).find(".divTampon").find(".vertical").find(".CC").eq(1).addClass("bg-danger progress-bar-striped progress-bar-animated")                 
                    $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CF").eq(0).addClass("progress-bar-striped progress-bar-animated")                
                    $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CC").eq(0).addClass("bg-danger progress-bar-striped progress-bar-animated")                  
                    $("#"+schemaID).find(".shuntC6").addClass("progress-bar-striped progress-bar-animatedreserve")
                    $("#"+schemaID).find(".progressC6").eq(1).addClass(" progress-bar-striped progress-bar-animatedreserve")
                    $("#"+schemaID).find('.tampon').addClass("fillBallon")
                    $("#"+schemaID).find(".exitTampon").addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                    $("#"+schemaID).find(".divTampon").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
                    $("#"+schemaID).find(".divTampon").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")
                    $("#"+schemaID).find(".divCapteurs").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")                
                    $("#"+schemaID).find(".divCapteurs").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
                    $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")                
                    $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")                      
                    $("#"+schemaID).find(".divDecouplagePrimaire").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")                    
                    $("#"+schemaID).find(".divDecouplagePrimaire").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
                }
            }
        }else{
            $("#"+schemaID).find(".C4").html('<i class="fa-solid fa-circle-play fa-2x"></i>')
        }
        //Si C5 tourne
        if (configInstantane['tr(2)'] != '0pC'){
            var htmlC5 = '<i class="fa-solid fa-circle-play fa-spin fa-2x"></i><span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-secondary">'+ affichageCirculateur(configInstantane, 'tr(2)', "C5") +'</span>'
            $("#"+schemaID).find(".C5").html(htmlC5)
            $("#"+schemaID).find(".C5CC").addClass("bg-danger progress-bar-striped progress-bar-animated")
            $("#"+schemaID).find(".C5CF").addClass("progress-bar-striped progress-bar-animated")
            //En fct de V3V tampon
            if (configInstantane['v3v(0)'] == 0){
                $("#"+schemaID).find(".divTampon").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
                $("#"+schemaID).find(".divTampon").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")
                $("#"+schemaID).find(".divCapteurs").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")                
                $("#"+schemaID).find(".divCapteurs").find(".CF").addClass("progress-bar-striped progress-bar-animated")
                $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CF").eq(0).addClass("progress-bar-striped progress-bar-animatedreserve")                
                $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CC").eq(0).addClass("bg-danger progress-bar-striped progress-bar-animated")                     
                $("#"+schemaID).find(".divDecouplagePrimaire").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")                    
                $("#"+schemaID).find(".divDecouplagePrimaire").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
            }else if (configInstantane['v3v(0)'] == "100"){
                $("#"+schemaID).find(".divTampon").find(".vertical").find(".CF").eq(1).addClass("bg-danger progress-bar-striped progress-bar-animated")
                $("#"+schemaID).find(".divTampon").find(".vertical").find(".CC").eq(1).addClass("bg-danger progress-bar-striped progress-bar-animated")                 
                $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CF").eq(0).addClass("progress-bar-striped progress-bar-animated")                
                $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CC").eq(0).addClass("bg-danger progress-bar-striped progress-bar-animated")               
                $("#"+schemaID).find(".shuntC6").addClass("bg-danger progress-bar-striped progress-bar-animated")
                $("#"+schemaID).find(".progressC6").eq(1).addClass("bg-danger progress-bar-striped progress-bar-animated")
                $("#"+schemaID).find('.tampon').addClass("fillBallon")
                $("#"+schemaID).find(".exitTampon").addClass("bg-danger progress-bar-striped progress-bar-animated")
            }else{                        
                $("#"+schemaID).find(".divTampon").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
                $("#"+schemaID).find(".divTampon").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")
                $("#"+schemaID).find(".divCapteurs").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")                
                $("#"+schemaID).find(".divCapteurs").find(".CF").addClass("progress-bar-striped progress-bar-animated")                
                $("#"+schemaID).find(".shuntC6, .exitTampon").addClass("bg-danger progress-bar-striped progress-bar-animated")
                $("#"+schemaID).find(".progressC6").eq(1).addClass("bg-danger progress-bar-striped progress-bar-animated")
                $("#"+schemaID).find('.tampon').addClass("fillBallon")                     
                $("#"+schemaID).find(".divDecouplagePrimaire").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")                    
                $("#"+schemaID).find(".divDecouplagePrimaire").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
            }



        }else{
            $("#"+schemaID).find(".C5").html('<i class="fa-solid fa-circle-play fa-2x"></i>')
        }
    
    //Affichage Appoint 2
    if (configInstantane['Type_Appoint(1)'] == '0'){
        $("#"+schemaID).find(".divAppoint2").hide()        
        $(".AddAvailable").append('<button class="btn btn-primary m-3"><i class="fas fa-plus-circle"></i> Appoint 2</button>')
    }else{
        $("#"+schemaID).find(".divAppoint2").show()
        //Affiche le type d'appoint et si allumé
        var html = APP2[parseInt(configInstantane['Type_Appoint(1)'])]
        if(configInstantane['rl(4)']== "On"){
            //Si appoint electrique mettre un éclair
            if(configInstantane['Type_Appoint(1)'] == "3"){
                html += ' <i class="fa-solid fa-bolt fa-x2 text-warning fa-beat-fade"></i>'
            }else{
                html += ' <i class="fa-solid fa-fire fa-x2 text-warning fa-beat-fade"></i>'
            }            
        }
        if(["5", "6"].includes(configInstantane['Type_Appoint(1)'])){
            html += '<br>'+ configInstantane['t(6)'].replace('dC', '') + "°C"
        }
        //Si C7 tourne
        if (configInstantane['tr(4)'] != '0pC'){
            var htmlC7 = '<i class="fa-solid fa-circle-play fa-spin fa-2x"></i><span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-secondary">'+ affichageCirculateur(configInstantane, 'tr(4)', "C7") +'</span>'
            $("#"+schemaID).find(".C7").html(htmlC7)
            $("#"+schemaID).find(".divAppoint2").find(".progress:not('.vertical')").find(".CF").addClass("bg-danger progress-bar-striped progress-bar-animated")
            $("#"+schemaID).find(".divAppoint2").find(".vertical").find(".CF").addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
            $("#"+schemaID).find(".divAppoint2").find(".CC").addClass("bg-warning progress-bar-striped progress-bar-animated")
            $("#"+schemaID).find(".divAppoint2").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")  
            $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CC").eq(2).addClass("bg-danger progress-bar-striped progress-bar-animated")
            $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CF").eq(2).addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
            switch(configInstantane["v3v(1)"]){
                case "100":                    
                $("#"+schemaID).find(".divAppoint1").find(".progress-bar").addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                    break;
                default:
                    $("#"+schemaID).find(".divAppoint1").find(".progress-bar").addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                case "0":                    
                    $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CF").addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                    $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")
                    $("#"+schemaID).find('.divDecouplagePrimaire').find('.CF').addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                    $("#"+schemaID).find('.divDecouplagePrimaire').find('.CC').addClass("bg-danger progress-bar-striped progress-bar-animated")
                    //en fonction de la V3V tampon
                    if (configInstantane['v3v(0)'] == "0"){
                        $("#"+schemaID).find(".divTampon").find(".vertical").find(".CF").addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                        $("#"+schemaID).find(".divTampon").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")
                        $("#"+schemaID).find(".divCapteurs").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")   
                        $("#"+schemaID).find(".divCapteurs").find(".vertical").find(".CF").addClass("bg-danger progress-bar-striped progress-bar-animatedreserve") 
                        $("#"+schemaID).find(".divCapteurs").find(".progress:not('.vertical')").find(".CF").addClass("bg-danger progress-bar-striped progress-bar-animated") 
                    }else if (configInstantane['v3v(0)'] == "100"){
                        $("#"+schemaID).find(".divTampon").find(".vertical").find(".CF").eq(1).addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                        $("#"+schemaID).find(".divTampon").find(".vertical").find(".CF").eq(2).addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                        $("#"+schemaID).find(".divTampon").find(".vertical").find(".CC").eq(1).addClass("bg-danger progress-bar-striped progress-bar-animated")
                        $("#"+schemaID).find(".shuntC6").eq(0).addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                        $("#"+schemaID).find(".shuntC6").eq(1).addClass("bg-danger progress-bar-striped progress-bar-animated")
                        $("#"+schemaID).find(".progressC6").eq(1).addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                        $("#"+schemaID).find('.tampon').addClass("fillBallon")
                        $("#"+schemaID).find(".exitTampon").addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                    }else{                        
                        $("#"+schemaID).find(".divCapteurs").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")   
                        $("#"+schemaID).find(".divCapteurs").find(".vertical").find(".CF").addClass("bg-danger progress-bar-striped progress-bar-animatedreserve") 
                        $("#"+schemaID).find(".divCapteurs").find(".progress:not('.vertical')").find(".CF").addClass("bg-danger progress-bar-striped progress-bar-animated")               
                        $("#"+schemaID).find(".divTampon").find(".vertical").find(".CF").addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                        $("#"+schemaID).find(".divTampon").find(".vertical").find(".CC").eq(1).addClass("bg-danger progress-bar-striped progress-bar-animated")
                        $("#"+schemaID).find(".exitTampon").addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                        $("#"+schemaID).find(".shuntC6").eq(0).addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                        $("#"+schemaID).find(".shuntC6").eq(1).addClass("bg-danger progress-bar-striped progress-bar-animated")
                        $("#"+schemaID).find(".progressC6").eq(1).addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                        $("#"+schemaID).find('.tampon').addClass("fillBallon")
                        $("#"+schemaID).find('.divDecouplagePrimaire').find('.CF').addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                        $("#"+schemaID).find('.divDecouplagePrimaire').find('.CC').addClass("bg-danger progress-bar-striped progress-bar-animated")
                    }
                    break;                
            }
        }else{
            var htmlC7 = '<i class="fa-solid fa-circle-play fa-2x"></i>'
            $("#"+schemaID).find(".C7").html(htmlC7) 
        }        
        $("#"+schemaID).find(".appoint2").html(html)
    }
    //Affichage Zones
    var lastZone = ""    
    $(".AddAvailable").append('<button class="btn btn-primary m-3"><i class="fas fa-plus-circle"></i> Zone</button>')
    for (const cle in configInstantane) {
        if (cle.startsWith("Type_Emetteur") && configInstantane[cle] != "0") {
            lastZone = cle
        } 
    }    
    var verticalProgressActive = false
    for (const cle in configInstantane) {
        if (cle.startsWith("Type_Emetteur")) {
            var jsonZone = parseInt(cle.replace("Type_Emetteur(", "").replace(")", ""))
            var nbZone = jsonZone+1
            var nbCirc = nbZone + 4
            if(configInstantane[cle] == '0'){
                $("#"+schemaID).find(".divZone" + nbZone).hide()
            }else{
                //Afficher la zone
                $("#"+schemaID).find(".divZone" + nbZone).show()
                //Afficher le label de température de la zone
                $("#"+schemaID).find(".labelT1"+nbZone).html(configInstantane["tlbl(1"+nbZone+")"])
                //Affiche la température 
                affichageTemperature(configInstantane,schemaID, "t(1"+nbZone+")", "T1"+nbZone)
                //Affiche la consigne et le type de demande
                if(configInstantane['Mode_Chauff('+ jsonZone +')']!="0"){
                    var badge = Dem[parseInt(configInstantane["Dem("+jsonZone+")"])]+"  " + configInstantane["Tcons("+jsonZone+")"] + "°C"
                    $("#"+schemaID).find(".badgeT1" + nbZone).html(badge)
                }
                //Affiche et anime le circulateur de la zone
                if (configInstantane['tr('+ nbCirc + ')'] != '0pC'){
                    verticalProgressActive = true
                    var html = '<i class="fa-solid fa-circle-play fa-spin fa-2x"></i><span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-secondary">'+ affichageCirculateur(configInstantane, 'tr('+ nbCirc + ')', "C"+ nbZone) +'</span>'
                    $("#"+schemaID).find(".C"+ nbZone).html(html)                    
                    $("#"+schemaID).find(".divZone"+ nbZone).find(".progress:not('.vertical')").find(".CF").addClass("progress-bar-striped progress-bar-animated")
                    $("#"+schemaID).find(".divZone"+ nbZone).find(".vertical.CF").addClass("progress-bar-striped progress-bar-animatedreserve")
                    $("#"+schemaID).find(".divZone"+ nbZone).find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")
                }else{
                    $("#"+schemaID).find(".C"+ nbZone).html('<i class="fa-solid fa-circle-play fa-2x"></i>') 
                }
                //Si c'est la dernière zone et qui'il n'y a pas d'appoint2 => rétréssit les progress vertical
                if (cle == lastZone && configInstantane['Type_Appoint(1)']=="0"){
                    $("#"+schemaID).find(".divZone"+ nbZone).find(".CF, .CC").parent(".vertical").height("65px")
                    $("#"+schemaID).find(".divZone"+ nbZone).find(".CF, .CC").parent(".vertical").parent(".position-absolute").css('top', '0%')
                }else{
                    $("#"+schemaID).find(".divZone"+ nbZone).find(".CF, .CC").parent(".vertical").height("105px")
                    $("#"+schemaID).find(".divZone"+ nbZone).find(".CF, .CC").parent(".vertical").parent(".position-absolute").css('top', '-45%')
                }
                //Si la zone 1 tourne et pas la zone 2, 3, ... les collecteurs verticaux sont animés
                if (verticalProgressActive){
                    $("#"+schemaID).find(".divZone"+ nbZone).find(".CC").parent(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")
                    $("#"+schemaID).find(".divZone"+ nbZone).find(".CF").parent(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
                    $("#"+schemaID).find(".divAppoint2").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")
                    $("#"+schemaID).find(".divAppoint2").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
                    $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CC").eq(2).addClass("bg-danger progress-bar-striped progress-bar-animated")
                    $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CF").eq(2).addClass("progress-bar-striped progress-bar-animatedreserve")
                    //si v3vAPP != 0
                    switch(configInstantane["v3v(1)"]){
                        case "100":
                            $("#"+schemaID).find(".divAppoint1").find(".progress-bar").addClass("progress-bar-striped progress-bar-animated")
                            if(configInstantane['ZoneAppoint(0)']!= "0"){
                                $("#"+schemaID).find(".divAppoint1").find(".progress-bar").eq(1).addClass("bg-danger")
                            }
                            break
                        case "0":
                            $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
                            $("#"+schemaID).find(".divBallonSanitaire").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")
                            //en fonction de la V3V tampon
                            if (configInstantane['v3v(0)'] == "0"){
                                $("#"+schemaID).find(".divTampon").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
                                $("#"+schemaID).find(".divTampon").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")
                                $("#"+schemaID).find(".divCapteurs, .divDecouplagePrimaire").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")
                                $("#"+schemaID).find(".divDecouplagePrimaire").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
                                $("#"+schemaID).find(".divCapteurs").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animatedreserve")
                                $("#"+schemaID).find(".divCapteurs").not(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animated")
                            }else if (configInstantane['v3v(0)'] == "100"){
                                $("#"+schemaID).find(".divTampon").find(".vertical").find(".CF").eq(1).addClass("progress-bar-striped progress-bar-animatedreserve")
                                $("#"+schemaID).find(".divTampon").find(".vertical").find(".CC").eq(1).addClass("bg-danger progress-bar-striped progress-bar-animated")
                                $("#"+schemaID).find(".shuntC6").addClass("progress-bar-striped progress-bar-animatedreserve")
                                $("#"+schemaID).find(".progressC6").eq(1).addClass("progress-bar-striped progress-bar-animatedreserve")
                                $("#"+schemaID).find('.tampon').addClass("fillBallon")
                                $("#"+schemaID).find(".exitTampon").addClass("bg-danger progress-bar-striped progress-bar-animatedreserve")
                            }else{                        
                                $("#"+schemaID).find(".divTampon").find(".vertical").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")
                                $("#"+schemaID).find(".divTampon").find(".vertical").find(".CF").addClass("progress-bar-striped progress-bar-animated")
                                $("#"+schemaID).find(".divCapteurs").find(".CC").addClass("bg-danger progress-bar-striped progress-bar-animated")                                
                                $("#"+schemaID).find(".divCapteurs").find(".CF").addClass(" progress-bar-striped progress-bar-animated")                       
                                $("#"+schemaID).find(".shuntC6, .exitTampon").addClass("bg-danger progress-bar-striped progress-bar-animated")
                                $("#"+schemaID).find(".progressC6").eq(1).addClass("bg-danger progress-bar-striped progress-bar-animated")
                                $("#"+schemaID).find('.tampon').addClass("fillBallon")
                            }
                            break;  
                    }
                }
            }

        }
    }
    afficheConnexion(configInstantane)
    const defdef = new defaults()
    defdef.AfficherMessageAllDefaults(configInstantane)
}
function convertirEnBooleens(nombreBinaire) {
    const resultat = [];
    const chaineBinaire = nombreBinaire.toString(2);
  
    for (const chiffre of chaineBinaire) {
      resultat.push(chiffre === "1");
    }
    var lenresul = 8-resultat.length
    for(let i=0; i<lenresul; i++){
        resultat.unshift(false)
    }
    return resultat;
  }
semaine=["lundi", "mardi", "mercredi", "jeudi", "vendredi", "samedi", "dimanche"]
function ProgHebdo(zone){
    //Génère le titre
    $("#Modal").find("button").last().html('Modifier')
    if(zone == "6"){
        $(".modal-title").html("Programmation hebdomadaire: Eau chaude Sanitaire")
    }else{
        zonenb= parseInt(zone) + 1
        $(".modal-title").html("Programmation hebdomadaire: Zone " + zonenb)
    }
    //Génère le tableau 
    tableau='<div class="table-responsive" style="line-height: 1.5"><table class="table-bordered w-100"><thead class="table-light"><th class="text-center" scope="row">Jour</th>'
    for (let heure = 0; heure < 24; heure++) {
        tableau+= `<th scope="col text-center" colspan="2">${heure}h</th>`;
    }  
    tableau+="</thead>"
    tableau+='<tbody class="table-group-divider">'
    for (let i=0; i<7; i++){
        tableau+= '<tr class="p-2">'
        tableau+='<td class="fw-bold text-center">'+semaine[i] +'</td>'
        for(let j = 0; j<6; j++){
            bina=convertirEnBooleens(parseInt(data["P("+zone+","+i+","+j+")"]))
            for(const [index, value] of bina.entries()){
                var heure=((j*8+index)-(j*8+index)%2)/2
                var heureplus = (j*8+index)%2 ? heure +1: heure
                var minute = (j*8+index)%2? "30": "00"
                var minuteplus = (j*8+index)%2? "00": "30"
                if(value){
                    tableau+='<td class="bg-danger confort" tabindex="0" data-bs-container="body" data-bs-toggle="popover" title="Plage horaire" data-bs-trigger="hover focus" data-bs-content="'+semaine[i]+':'+heure+':'+minute+'&#10140;'+ heureplus +':'+minuteplus+'"></td>'
                }else{
                    tableau+='<td class="bg-primary confort" tabindex="0" data-bs-container="body" data-bs-toggle="popover" title="Plage horaire" data-bs-trigger="hover focus" data-bs-content="'+semaine[i]+':'+heure+':'+minute+' &#10140; '+ heureplus +':'+minuteplus+'"></td>'
                }
            }
        }
        tableau+= '</tr>'
    }    
    tableau+='</tbody>'
    tableau+="</table></div>"
    $(".modal-body").html(tableau)
    $(".confort").on("click", function(){
        $(this).toggleClass("bg-primary bg-danger")
    })
    //popover start
    var popoverTriggerList = [].slice.call(document.querySelectorAll('.confort'))
    var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
    return new bootstrap.Popover(popoverTriggerEl)
    })
}
function scrollToDescription(){
    $('html, body').animate({
        scrollTop: $("#description").offset().top
    }, 400);
}
function animationSelection(element){
    $(".fa-bounce").removeClass('fa-bounce selected')
    $(element).addClass('fa-bounce selected')
}


$(".zone").on("click", function(){
    animationSelection(this)
    listclass = $(this).find("span").eq(0).attr('class').split(/\s+/)
    $.each(listclass, function(idx, value){
        if (value.startsWith("T")){
            nbZone = value.replace("T1", "")
            nbZoneindexinf = parseInt(nbZone) -1
        }
    })
    $("#description").html("<h1 class='text-center'>Zone "+nbZone +": "+  data["tlbl(1"+nbZone+")"] + "</h1>")
    scrollToDescription()    
    
    htmlUtilisateur='<fieldset class="border-top p-2 text-center"><legend class="float-none w-auto">Paramètre utilisateur</legend>'
    +'<div class="row"><div class="col-12"><div class="btn-group pl-2 pb-3 text-center" role="group" aria-label="Basic radio toggle button group">'
    switch (data['Mode_Chauff('+ nbZoneindexinf +')']){
        case "0":
            htmlUtilisateur+='<input type="radio" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off" checked>'
            +'<label class="btn btn-outline-primary" for="btnradio1"><i class="fas fa-stop-circle"></i> Arrêt</label>'  
            +'<input type="radio" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off">'
            +'<label class="btn btn-outline-primary" for="btnradio2"><i class="far fa-sun"></i> Solaire</label>'  
            +'<input type="radio" class="btn-check" name="btnradio" id="btnradio3" autocomplete="off">'
            +'<label class="btn btn-outline-primary" for="btnradio3"><i class="far fa-sun"></i> Solaire + <i class="fa-solid fa-fire"></i> Appoint</label>'
            break
        case "1":
            htmlUtilisateur+='<input type="radio" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off">'
                +'<label class="btn btn-outline-primary" for="btnradio1"><i class="fas fa-stop-circle"></i> Arrêt</label>'  
                +'<input type="radio" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off" checked>'
                +'<label class="btn btn-outline-primary" for="btnradio2"><i class="far fa-sun"></i> Solaire</label>'  
                +'<input type="radio" class="btn-check" name="btnradio" id="btnradio3" autocomplete="off">'
                +'<label class="btn btn-outline-primary" for="btnradio3"><i class="far fa-sun"></i> Solaire + <i class="fa-solid fa-fire"></i> Appoint</label>'
            break
        case "2":
            htmlUtilisateur+='<input type="radio" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off">'
                +'<label class="btn btn-outline-primary" for="btnradio1"><i class="fas fa-stop-circle"></i> Arrêt</label>'  
                +'<input type="radio" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off">'
                +'<label class="btn btn-outline-primary" for="btnradio2"><i class="far fa-sun"></i> Solaire</label>'  
                +'<input type="radio" class="btn-check" name="btnradio" id="btnradio3" autocomplete="off" checked>'
                +'<label class="btn btn-outline-primary" for="btnradio3"><i class="far fa-sun"></i> Solaire + <i class="fa-solid fa-fire"></i> Appoint</label>'
            break
        
    }
    htmlUtilisateur+='</div></div>'
    +'<div class="col-12 col-lg-8 m-auto"><div class="input-group mb-3">'
    +'<span class="input-group-text" id="basic-addon1">'
    +'<i class="fas fa-temperature-high"></i>'
    +'</span>'
    +'<div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température voulue pendant les heures de présence.<br>Elle doit être supérieure à la température de réduit.">'
    +'<input type="number" step="0.5" min="5" max="50" class="form-control" value="'+data['TConfort('+ nbZoneindexinf +')']+'">'
    +'<label>Confort</label>'
    +'</div><div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température voulue pendant les heures d\'absence.<br>Elle doit être inférieure à la température de confort.">'
    +'<input type="number" step="0.5" min="5" max="50" class="form-control" value="'+data['TReduit('+ nbZoneindexinf +')']+'">'
    +'<label>Réduit</label>'
    +'</div>'
    +'<span class="input-group-text">°C</span>'
    +'</div></div>'    
    +'<div class="col-12 col-lg-8 p-3 m-auto">'
    +'<div class="input-group mb-3"><div class="input-group-text">'
    +'<div class="form-check m-auto">'
    +'<input class="form-check-input mt-1" type="checkbox" id="derogation">'
    +'<label class="form-check-label" for="derogation">Dérogation 4 heures</label>'
    +'</div></div>'
    +'<div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température de dérogation pendant 4 heures. Valable uniquement en appoint">'
    +'<input id="derogationValue" type="number" step="1" min="0" max="4" class="form-control" value="'+data['DTDerog('+ nbZoneindexinf +')']+'"'
    if(data['rebour_derog_z'+ nbZone]==0){
        htmlUtilisateur+= " disabled>"
    }else{
        htmlUtilisateur+= ">"
    }
    htmlUtilisateur+='<label>Dérogation</label>'
    +'</div>'
    +'<span class="input-group-text">°C</span>'
    +'</div></div>'
    +'</div>'
    +'<div class="col-12"><button class="btn btn-outline-primary m-auto" data-bs-toggle="modal" data-bs-target="#Modal" onclick="ProgHebdo('+ nbZoneindexinf +')">Programmation hebdomadaire</button>'
    +'</div></div></fieldset>'
    $("#parametreUtilisateur").html(htmlUtilisateur)
    var profil = "installateur"
    if(profil=="installateur"){
        paramInstall = '<fieldset class="border-top p-2 text-center"><legend class="float-none w-auto">Paramètre installateur</legend>'
        +'<div class="input-group mb-3">'
        +'<div class="form-floating">'
        +'<select class="form-select" value="'+data['Type_Emetteur('+ nbZoneindexinf +')']+'">'
        //pour selectionner le type d'émetteur
        $.each(Type_Emetteur, function(idx, value){
            var select = ""
            if(data['Type_Emetteur('+ nbZoneindexinf +')']==idx){
                select = "selected"
            }
            paramInstall+='<option value="'+idx+'" '+select+'>'+value+'</option>'
        })
        paramInstall+='</select>'
        paramInstall+='<label>Type d\'émetteur</label>'
        +'</div><div class="form-floating">'
        +'<input type="text" class="form-control" value="'+data["tlbl(1"+nbZone+")"]+'">'
        +'<label>Désignation</label>'
        +'</div>'
        +'</div>'
        paramInstall+='<div class="input-group mb-3">'
        +'<span class="input-group-text" id="basic-addon1">DT</span>'        
        +'<div class="form-floating" tabindex="0" data-bs-container="body" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Différence de température minimum entre T8 et la loi d\'eau en solaire pour démarrer le circulateur">'
        +'<input type="number" step="1" min="5" max="50" class="form-control" value="'+data["DTEco("+nbZoneindexinf+")"]+'">'
        +'<label>ON Solaire</label>'
        +'</div>'
        +'<div class="form-floating"data-bs-container="body" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Différence de température minimum entre T8 et la loi d\'eau avec l\'appoint pour démarrer le circulateur">'
        +'<input type="number" step="1" min="5" max="50" class="form-control" value="'+data["DTOn("+nbZoneindexinf+")"]+'">'
        +'<label>ON Appoint</label>'
        +'</div>'
        +'<div class="form-floating" data-bs-container="body" data-bs-toggle="popover"  data-bs-placement="left" title="Information" data-bs-trigger="hover focus" data-bs-content="Différence de température minimum entre T8 et la loi d\'eau pour arrêter le circulateur">'
        +'<input type="number" step="1" min="5" max="50" class="form-control" value="'+data["DTOff("+nbZoneindexinf+")"]+'">'
        +'<label>OFF</label>'
        +'</div>'
        +'<span class="input-group-text" id="basic-addon1">°C</span>'
        +'</div>'
        paramInstall+='<div class="input-group mb-3">'
        +'<div class="form-floating" tabindex="0" data-bs-container="body" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température de surchauffe solaire">'
        +'<input type="number" step="0.1" min="0" max="5" class="form-control" value="'+data["DTMaxSol("+nbZoneindexinf+")"]+'">'
        +'<label>Surchauffe Solaire</label>'
        +'</div>'
        +'<div class="form-floating" tabindex="0" data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température de correction de la sonde de température">'
        +'<input type="number" step="0.1" min="-3" max="3" class="form-control" value="'+data["DTCorrTA("+nbZoneindexinf+")"]+'">'
        +'<label>Correction Sonde</label>'
        +'</div>'
        +'<span class="input-group-text" id="basic-addon1">°C</span>'
        +'</div>'
        paramInstall+='<div class="input-group mb-3">'
        +'<span class="input-group-text" id="basic-addon1">Loi d\'eau</span>'
        +'<div class="form-floating" tabindex="0" data-bs-container="body" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température de départ de la loi d\'eau à la température de base extérieur ici: '+ data['TBaseExt(0)']+ '°C">'
        +'<input type="number" step="0.1" min="-3" max="3" class="form-control" value="'+data["TBaseEnvoi("+nbZoneindexinf+")"]+'">'
        +'<label>Base</label>'
        +'</div>'
        +'<div class="form-floating" tabindex="0" data-bs-container="body" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température de départ de la loi d\'eau à 20°C">'
        +'<input type="number" step="0.1" min="-3" max="3" class="form-control" value="'+data["TMinEnvoi("+nbZoneindexinf+")"]+'">'
        +'<label>Min</label>'
        +'</div>'
        +'<div class="form-floating" tabindex="0" data-bs-container="body" data-bs-toggle="popover"  data-bs-placement="left" title="Information" data-bs-trigger="hover focus" data-bs-content="Température maximum de départ de la loi d\'eau">'
        +'<input type="number" step="0.1" min="-3" max="3" class="form-control" value="'+data["TMaxEnvoi("+nbZoneindexinf+")"]+'">'
        +'<label>Max</label>'
        +'</div>'
        +'<span class="input-group-text" id="basic-addon1">°C</span>'
        +'</div>'
        paramInstall+='</fieldset>'
        $("#parametreInstallateur").html(paramInstall)
        $("#parametreInstallateur")
        $("#derogation").on("click", function(){
            $("#derogationValue").prop('disabled', (i, v) => !v)
        })
        //popover start
        var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
        var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
        return new bootstrap.Popover(popoverTriggerEl)
        })
    }
})
$(".appoint2, .appoint1").on("click", function(){
    animationSelection(this)
    if($(this).hasClass("appoint1")){
        var nbAppoint =1
        var nbAppointindexinf = 0
        var typeAppoint = APP1[parseInt(data["Type_Appoint(0)"])]
        var ChoixApp = APP1
    }else{
        var nbAppoint =2
        var nbAppointindexinf = 1
        var typeAppoint = APP2[parseInt(data["Type_Appoint(1)"])]        
        var ChoixApp = APP2
    }
    
    $("#description").html("<h1 class='text-center'>Appoint "+nbAppoint +": "+  typeAppoint + "</h1>") 
    scrollToDescription()
    $("#parametreUtilisateur").html("") 
    //todo en fct de l'appoint 1 ou 2 récup les bonnes données sur la base
    paramUtil = '<fieldset class="border-top p-2 text-center"><legend class="float-none w-auto">Paramètre utilisateur</legend>'
    +'<div class="input-group mb-3">'
    +'<div class="form-floating">'
    +'<input type="text" class="form-control" value="Marque">'
    +'<label>Marque</label>'
    +'</div>'
    +'<div class="form-floating">'
    +'<input type="text" class="form-control" value="Marque">'
    +'<label>Modèle</label>'
    +'</div>'
    +'</div>'
    +'<div class="input-group mb-3">'
    +'<div class="form-floating">'
    +'<input type="number" class="form-control" value="Marque">'
    +'<label>Puissance</label>'
    +'</div>'
    +'<span class="input-group-text" id="basic-addon1">W</span>'
    +'</div>'
    +'</fieldset>'

    paramInstall = '<fieldset class="border-top p-2 text-center"><legend class="float-none w-auto">Paramètre installateur</legend>'
        +'<div class="input-group mb-3">'
        +'<div class="form-floating">'
        +'<select class="form-select" value="'+data['Type_Emetteur('+ nbZoneindexinf +')']+'">'
        //pour selectionner le type d'appoint
        $.each(ChoixApp, function(idx, value){
            var select = ""
            if(data['Type_Appoint('+ nbAppointindexinf+')']==idx){
                select = "selected"
            }
            if(value != ""){
                paramInstall+='<option value="'+idx+'" '+select+'>'+value+'</option>'
            }
        })
        paramInstall+='</select>'
        paramInstall+='<label>Type d\'appoint</label>'
        +'</div><div class="form-floating">'
        +'<select class="form-select" value="'+data['Type_Emetteur('+ nbZoneindexinf +')']+'">'
        //pour selectionner la zone
        $.each(ZoneAppoint, function(idx, value){
            var select = ""
            if(data['ZoneAppoint('+ nbAppointindexinf+')']==idx){
                select = "selected"
            }
            paramInstall+='<option value="'+idx+'" '+select+'>'+value+'</option>'
        })
        paramInstall+='</select>'
        +'<label>Zone-pressostat</label>'
        +'</div>'
        +'</div>'      
        paramInstall+='<div class="input-group mb-3">' 
        +'<span class="input-group-text" id="basic-addon1"><i class="fas fa-thermometer-half"></i></span>'
        +'<div class="form-floating" tabindex="0" data-bs-container="body" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température maximum dans l\'appoint">'
        +'<input type="number" step="1" min="50" max="100" class="form-control" value="'+data["TMaxApp("+nbZoneindexinf+")"]+'">'
        +'<label>max. dans l\'appoint</label>'
        +'</div>'
        +'<div class="form-floating"data-bs-container="body" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température minimum de retour dans l\'appoint">'
        +'<input type="number" step="1" min="5" max="90" class="form-control" value="'+data["TRetMinChdr("+nbZoneindexinf+")"]+'">'
        +'<label>min. retour chaudière</label>'
        +'</div>'
        +'<div class="form-floating" data-bs-container="body" data-bs-toggle="popover"  data-bs-placement="left" title="Information" data-bs-trigger="hover focus" data-bs-content="Température minimum dans l\'appoint">'
        +'<input type="number" step="1" min="5" max="90" class="form-control" value="'+data["TStockECS("+nbZoneindexinf+")"]+'">'
        +'<label>min. du corps de chauffe</label>'
        +'</div>'
        +'<span class="input-group-text" id="basic-addon1">°C</span>'
        +'</div>'
        paramInstall+='<div class="input-group mb-3">'
        +'<span class="input-group-text" id="basic-addon1"><i class="fas fa-thermometer-half"></i></span>'
        +'<div class="form-floating" tabindex="0" data-bs-container="body" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Différence de température entre l\'appoint et la loi d\'eau pour éteindre l\'appoint">'
        +'<input type="number" step="0.1" min="0" max="60" class="form-control" value="'+data["DTChdr("+nbZoneindexinf+")"]+'">'
        +'<label>DT Appoint</label>'
        +'</div>'
        +'<div class="form-floating" tabindex="0" data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Surchauffe de l\'eau chaude sanitaire par rapport à la consigne pour augmenter l\'autonomie sur une journée">'
        +'<input type="number" step="0.1" min="0" max="40" class="form-control" value="'+data["DTAppECS("+nbZoneindexinf+")"]+'">'
        +'<label>DT ECS</label>'
        +'</div>'
        +'<span class="input-group-text" id="basic-addon1">°C</span>'
        +'</div>'
        paramInstall+='<div class="input-group mb-3">'
        +'<span class="input-group-text" id="basic-addon1"><i class="fas fa-stopwatch"></i>AntiCourt Cycle</span>'
        +'<div class="form-floating" tabindex="0" data-bs-container="body" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Temps minimum où l\'appoint doit fonctionner">'
        +'<input type="number" step="0.1" min="0" max="180" class="form-control" value="'+data["MinOnDelay("+nbZoneindexinf+")"]+'">'
        +'<label>Min fonctionnement</label>'
        +'</div>'
        +'<div class="form-floating" tabindex="0" data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Temps minimum où l\'appoint doit être arrêté">'
        +'<input type="number" step="0.1" min="0" max="180" class="form-control" value="'+data["MinOffDelay("+nbZoneindexinf+")"]+'">'
        +'<label>Min Arrêt</label>'
        +'</div>'
        +'<span class="input-group-text" id="basic-addon1">min</span>'
        +'</div>'
        paramInstall+='<div class="input-group mb-3">'
        +'<div class="form-floating" tabindex="0" data-bs-container="body" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Permet de temporiser les démarrage des circulateurs">'
        +'<input type="number" step="0.1" min="0" max="180" class="form-control" value="'+data["VolCorpsChf("+nbZoneindexinf+")"]+'">'
        +'<label>Volume Corps de chauffe</label>'
        +'</div>'
        +'<span class="input-group-text" id="basic-addon1">L</span>'
        +'<div class="form-floating" tabindex="0" data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Permet au circulateur de moduler sa vitesse">'
        +'<input type="number" step="0.1" min="0" max="180" class="form-control" value="'+data["VMinCircApp("+nbZoneindexinf+")"]+'">'
        +'<label>Vitesse min Circulateur</label>'
        +'</div>'        
        +'<span class="input-group-text" id="basic-addon1">%</span>'
        +'</div>'
        paramInstall+='</fieldset>'
        $("#parametreInstallateur").html(paramInstall)
        $("#parametreUtilisateur").html(paramUtil)
        var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
        var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
        return new bootstrap.Popover(popoverTriggerEl)
        })
})
$(".BallonSanitaire, .T4, .T3").on("click", function(){  
    animationSelection(this)  
    $("#description").html("<h1 class='text-center'>Eau Chaude Sanitaire</h1>") 
    scrollToDescription()
    htmlUtilisateur='<fieldset class="border-top p-2 text-center"><legend class="float-none w-auto">Paramètre utilisateur</legend>'
    +'<div class="row"><div class="col-12">'
    +'<div class="col-12 col-lg-8 m-auto"><div class="input-group mb-3">'
    +'<span class="input-group-text" id="basic-addon1">'
    +'<i class="fas fa-info-circle"></i>'
    +'</span>'
    +'<div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température voulue pendant les heures de présence.<br>Elle doit être supérieure à la température de réduit.">'
    +'<input type="text" step="0.5" min="5" max="50" class="form-control" value="SC2 500L">'
    +'<label>Chauffage solaire & Ballon</label>'
    +'</div>'
    +'</div></div>'
    +'<div class="btn-group pl-2 pb-3 text-center" role="group" aria-label="Basic radio toggle button group">'
    switch (data['Mode_Chauff(6)']){
        case "0":
            htmlUtilisateur+='<input type="radio" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off" checked>'
            +'<label class="btn btn-outline-primary" for="btnradio1"><i class="fas fa-stop-circle"></i> Arrêt</label>'  
            +'<input type="radio" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off">'
            +'<label class="btn btn-outline-primary" for="btnradio2"><i class="far fa-sun"></i> Solaire</label>'  
            +'<input type="radio" class="btn-check" name="btnradio" id="btnradio3" autocomplete="off">'
            +'<label class="btn btn-outline-primary" for="btnradio3"><i class="far fa-sun"></i> Solaire + <i class="fa-solid fa-fire"></i> Appoint</label>'
            break
        case "1":
            htmlUtilisateur+='<input type="radio" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off">'
                +'<label class="btn btn-outline-primary" for="btnradio1"><i class="fas fa-stop-circle"></i> Arrêt</label>'  
                +'<input type="radio" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off" checked>'
                +'<label class="btn btn-outline-primary" for="btnradio2"><i class="far fa-sun"></i> Solaire</label>'  
                +'<input type="radio" class="btn-check" name="btnradio" id="btnradio3" autocomplete="off">'
                +'<label class="btn btn-outline-primary" for="btnradio3"><i class="far fa-sun"></i> Solaire + <i class="fa-solid fa-fire"></i> Appoint</label>'
            break
        case "2":
            htmlUtilisateur+='<input type="radio" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off">'
                +'<label class="btn btn-outline-primary" for="btnradio1"><i class="fas fa-stop-circle"></i> Arrêt</label>'  
                +'<input type="radio" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off">'
                +'<label class="btn btn-outline-primary" for="btnradio2"><i class="far fa-sun"></i> Solaire</label>'  
                +'<input type="radio" class="btn-check" name="btnradio" id="btnradio3" autocomplete="off" checked>'
                +'<label class="btn btn-outline-primary" for="btnradio3"><i class="far fa-sun"></i> Solaire + <i class="fa-solid fa-fire"></i> Appoint</label>'
            break
        
    }
    htmlUtilisateur+='</div></div>'
    +'<div class="col-12 col-lg-8 m-auto"><div class="input-group mb-3">'
    +'<span class="input-group-text" id="basic-addon1">'
    +'<i class="fas fa-temperature-high"></i>'
    +'</span>'
    +'<div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température voulue pendant les heures de présence.<br>Elle doit être supérieure à la température de réduit.">'
    +'<input type="number" step="0.5" min="5" max="50" class="form-control" value="'+data['TConfort(6)']+'">'
    +'<label>Confort</label>'
    +'</div><div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température voulue pendant les heures d\'absence.<br>Elle doit être inférieure à la température de confort.">'
    +'<input type="number" step="0.5" min="5" max="50" class="form-control" value="'+data['TReduit(6)']+'">'
    +'<label>Réduit</label>'
    +'</div>'
    +'<span class="input-group-text">°C</span>'
    +'</div></div>'
    +'<div class="col-12 col-lg-8 p-3 m-auto">'
    +'<div class="input-group mb-3"><div class="input-group-text">'
    +'<div class="form-check m-auto">'
    +'<input class="form-check-input mt-1" type="checkbox" id="derogation">'
    +'<label class="form-check-label" for="derogation">Dérogation 4 heures</label>'
    +'</div></div>'
    +'<div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température de dérogation pendant 4 heures. Valable uniquement en appoint">'
    +'<input id="derogationValue" type="number" step="1" min="0" max="4" class="form-control" value="'+data['DTDerog(6)']+'"'
    if(data['rebour_derog_ECS'] =="0"){
        htmlUtilisateur+= " disabled>"
    }else{
        htmlUtilisateur+= ">"
    }
    htmlUtilisateur+='<label>Dérogation</label>'
    +'</div>'
    +'<span class="input-group-text">°C</span>'
    +'</div></div>'
    +'</div>'
    +'<div class="col-12"><button class="btn btn-outline-primary m-auto" data-bs-toggle="modal" data-bs-target="#Modal" onclick="ProgHebdo(6)">Programmation hebdomadaire</button>'
    +'</div></div></fieldset>'
    $("#parametreUtilisateur").html(htmlUtilisateur)
    htmlUtilisateur+='</div></div></div>'
    var profil = "installateur"
    if(profil=="installateur"){
        paramInstall = '<fieldset class="border-top p-2 text-center"><legend class="float-none w-auto">Paramètre installateur</legend>'
        +'<div class="input-group mb-3">'
        +'<span class="input-group-text" id="basic-addon1">'
        +'<i class="fas fa-temperature-high"></i>'
        +'</span>'
        +'<div class="form-floating">'
        +'<input type="number" step="1" min="0" max="105" class="form-control" value="'+data["TMaxECSA"]+'">'
        +'<label>T<inf>max</inf> haut de ballon</label>'
        +'</div>'
        +'<div class="form-floating">'
        +'<input type="number" step="1" min="0" max="105" class="form-control" value="'+data["TMaxECSS"]+'">'
        +'<label>T<inf>max</inf> bas de ballon</label>'
        +'</div>'
        +'<span class="input-group-text" id="basic-addon1">°C</span>'
        +'</div>'        
        +'</fieldset>'


    }else{
        paramInstall =""
    }
    $("#parametreInstallateur").html(paramInstall)
    $("#derogation").on("click", function(){
        $("#derogationValue").prop('disabled', (i, v) => !v)
    })
    //popover start
    var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
    var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
    return new bootstrap.Popover(popoverTriggerEl)
    })
})
$(".tampon, .T5").on("click", function(){    
    animationSelection(this)
    $("#description").html("<h1 class='text-center'>Tampon</h1>") 
    scrollToDescription()
    $("#parametreUtilisateur").html('')
    var profil = "installateur"
    if(profil=="installateur"){
        paramInstall = '<fieldset class="border-top p-2 text-center"><legend class="float-none w-auto">Paramètre installateur</legend>'
        +'<div class="input-group mb-3">'
        +'<span class="input-group-text" id="basic-addon1">'
        +'<i class="fas fa-temperature-high"></i>'
        +'</span>'
        +'<div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température maximale du ballon tampon.">'
        +'<input type="number" step="0.1" min="-3" max="3" class="form-control" value="'+data["TMaxECSC"]+'">'
        +'<label>T<inf>max</inf></label>'
        +'</div>'
        +'<div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température minimale du bas de ballon sanitaire pour chauffer le tampon">'
        +'<input type="number" step="0.1" min="-3" max="3" class="form-control" value="'+data["TBasculECS"]+'">'
        +'<label>T<inf>min</inf> T3 pour chauffer</label>'
        +'</div>'
        +'<span class="input-group-text" id="basic-addon1">°C</span>'
        +'</div>'
        +'</fieldset>'
    }else{
        paramInstall =""
    }
    $("#parametreInstallateur").html(paramInstall)
    //popover start
    var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
    var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
    return new bootstrap.Popover(popoverTriggerEl)
    })
})
$(".fa-solar-panel, .T1, .T10").on("click", function(){  
    animationSelection(this)  
    $("#description").html("<h1 class='text-center'>Capteurs</h1>") 
    scrollToDescription()
    $("#parametreUtilisateur").html('')
    var profil = "installateur"
    if(profil=="installateur"){
        paramUtil = '<fieldset class="border-top p-2 text-center"><legend class="float-none w-auto">Paramètre installateur</legend>'              
        +'<div class="input-group mb-3">'
        +'<span class="input-group-text" id="basic-addon1"><i class="fa-solid fa-solar-panel"></i></span>'
        +'<div class="form-floating">'
        +'<input type="number" step="0.5" min="0" max="100" class="form-control" value="12">'
        +'<label>Surface</label>'
        +'</div>'
        +'<span class="input-group-text" id="basic-addon1">'
        +'m²'
        +'</span>'
        +'</div>'
        +'<div class="input-group mb-3">'
        +'<span class="input-group-text" id="basic-addon1"><i class="fa-solid fa-solar-panel"></i></span>'
        +'<div class="form-floating">'
        +'<input type="text" class="form-control" value="SI2.5">'
        +'<label>Type de Capteur</label>'
        +'</div>'
        +'</div>'
        +'<div class="input-group mb-3">'
        +'<span class="input-group-text" id="basic-addon1"><i class="fa-solid fa-solar-panel"></i></span>'
        +'<div class="form-floating">'
        +'<input type="number" step="0.5" min="0" max="360" class="form-control" value="180">'
        +'<label>Orientation</label>'
        +'</div>'
        +'<span class="input-group-text" id="basic-addon1">'
        +'m²'
        +'</span>'
        +'<div class="form-floating">'
        +'<input type="number" step="5" min="0" max="180" class="form-control" value="60">'
        +'<label>Inclinaison</label>'
        +'</div>'
        +'<span class="input-group-text" id="basic-addon1">°</span>'
        +'</div>'  
        +'</fieldset>'

        paramInstall = '<fieldset class="border-top p-2 text-center"><legend class="float-none w-auto">Paramètre installateur</legend>'
        +'<div class="input-group mb-3">'
        +'<span class="input-group-text" id="basic-addon1"><i class="fa-solid fa-solar-panel"></i></span>'
        +'<div class="form-floating">'
        +'<select class="form-select" value="'+data['Nb_Champs_Capt']+'">'
        //pour selectionner le type d'émetteur
        $.each(capteur, function(idx, value){
            var select = ""
            if(data['Nb_Champs_Capt']==idx){
                select = "selected"
            }
            paramInstall+='<option value="'+idx+'" '+select+'>'+value+'</option>'
        })
        paramInstall+='</select>'
        paramInstall+='<label>Type de Capteur</label>'
        +'</div></div>'
        +'<div class="input-group mb-3">'
        +'<span class="input-group-text" id="basic-addon1">'
        +'DT Capteur/Ballon'
        +'</span>'
        +'<div class="form-floating">'
        +'<input type="number" step="0.1" min="-3" max="3" class="form-control" value="'+data["DTCapteurOn"]+'">'
        +'<label>ON</label>'
        +'</div>'
        +'<div class="form-floating">'
        +'<input type="number" step="0.1" min="-3" max="3" class="form-control" value="'+data["DTCapteurOff"]+'">'
        +'<label>OFF</label>'
        +'</div>'
        +'<span class="input-group-text" id="basic-addon1">°C</span>'
        +'</div>'
        +'<div class="input-group mb-3">'
        +'<span class="input-group-text" id="basic-addon1">'
        +'<i class="fa-solid fa-gauge"></i>'
        +'</span>'
        +'<div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Vitesse minimale du circulateur.(100% ne permet pas de modulation)">'
        +'<input type="number" step="0.1" min="50" max="100" class="form-control" value="'+data["VMinCircCapteur"]+'">'
        +'<label>Vitesse min du Ciculateur sur les capteurs</label>'
        +'</div>'
        +'<span class="input-group-text" id="basic-addon1">%</span>'
        +'</div>'
        +'<div class="input-group mb-3">'
        +'<span class="input-group-text" id="basic-addon1">'
        +'<i class="fas fa-temperature-high"></i>'
        +'</span>'
        +'<div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température de pilotage des capteurs en mode dégradé">'
        +'<input type="number" step="0.1" min="50" max="100" class="form-control" value="'+data["TMarcheDeg"]+'">'
        +'<label>Mode Dégradé</label>'
        +'</div>'
        +'<div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température de décharge nocture en excédant d\'énergie">'
        +'<input type="number" step="0.1" min="50" max="100" class="form-control" value="'+data["DTChrgBallon"]+'">'
        +'<label>Décharge Nocturne</label>'
        +'</div>'
        +'<span class="input-group-text" id="basic-addon1">°C</span>'
        +'</div>'
        +'</fieldset>'
    }else{
        paramInstall =""
    }
    $("#parametreUtilisateur").html(paramUtil)
    $("#parametreInstallateur").html(paramInstall)
    //popover start
    var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
    var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
    return new bootstrap.Popover(popoverTriggerEl)
    })
})
$(".T1, .T2, .T6, .T7, .T8, .T9, .T10, .T11, .T12, .T13, .T14, .T15, .T16").on("click", function(){
    animationSelection(this)
    const regex = /T\d{1,2}/;
    var sonde = $(this).attr('class').split(/\s+/).filter(item => regex.test(item))[0]
    var label = parseInt(sonde.replace('T', ''))<10?data[sonde.replace('T', 'tlbl(0') + ')']: data[sonde.replace('T', 'tlbl(') + ')']
    $("#description").html("<h1 class='text-center'>Sonde "+sonde+": "+label+ "</h1>")
    scrollToDescription()
    $("#parametreUtilisateur").html('')
    $("#parametreInstallateur").html('')    
    htmlUtilisateur='<fieldset class="border-top p-2 text-center"><legend class="float-none w-auto">Paramètre installateur</legend>'
    +'<div class="input-group mb-3">'
    +'<span class="input-group-text"><i class="fa-solid fa-tag"></i></span>'
    +'<div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température de dérogation pendant 4 heures. Valable uniquement en appoint">'
    +'<input type="text" class="form-control datepicker" value="'+label+'">'
    +'<label>Label</label>'
    +'</div>'
    htmlUtilisateur+= '</fieldset>'
    $("#parametreInstallateur").html(htmlUtilisateur)
})
function affichageCiculateur(circulateur, label, vitesse){
    $("#description").html("<h1 class='text-center'>Circulateur "+ circulateur +": "+label+ "</h1>") 
    scrollToDescription()
    $("#parametreUtilisateur").html('')
    $("#parametreInstallateur").html('')    
    htmlUtilisateur='<fieldset class="border-top p-2 text-center"><legend class="float-none w-auto">Paramètre installateur</legend>'
    +'<div class="row">'
    +'<div class="col-6">'
    +'<div class="input-group mb-3">'
    +'<span class="input-group-text"><i class="fa-solid fa-tag"></i></span>'
    +'<div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Température de dérogation pendant 4 heures. Valable uniquement en appoint">'
    +'<input type="text" class="form-control datepicker" value="'+label+'">'
    +'<label>Label</label>'
    +'</div>'
    +'</div>'    
    +'</div>'
    +'<div class="col-6">'
    +'<div class="input-group mb-3">'
    +'<span class="input-group-text"><i class="fa-solid fa-gauge"></i></span>'
    +'<div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Label">'
    +'<select type="text" class="form-select datepicker" value="'+ vitesse +'">'
    $.each(vitesseCirculateur, function(i, v){
        if(i==vitesse){
            htmlUtilisateur+='<option value="'+i+'" selected>'+v+'</option>'
        }else{
            htmlUtilisateur+='<option value="'+i+'">'+v+'</option>'
        }
    })
    htmlUtilisateur+='</select>'
    +'<label>Vitesse</label>'
    +'</div>'
    +'</div>'
    +'</div>'
    +'<div class="col-12">'
    +'<div class="input-group mb-3">'
    +'<span class="input-group-text"><i class="fab fa-superpowers"></i></span>'
    +'<div class="form-floating" tabindex="0" data-bs-html=true data-bs-container="body" data-bs-placement="left" data-bs-toggle="popover"  title="Information" data-bs-trigger="hover focus" data-bs-content="Forcer le circulateur pendant 2 min">'
    +'<input type="number" step="1" min="0" max="100" class="form-control datepicker" value="0">'
    +'<label>Forcer Circulateur</label>'
    +'</div>'
    +'<span class="input-group-text">%</span>'
    +'<button class="btn btn-outline-secondary" type="button">Forcer</button>'
    +'</div>'    
    +'</div>'    
    +'</div>'
    +'</fieldset>'
    $("#parametreInstallateur").html(htmlUtilisateur)

}
$(".C1, .C2, .C3, .C4, .C5, .C6, .C7").on("click", function(){
    animationSelection(this)
    const regex = /C\d{1,2}/;
    var circulateur = $(this).attr('class').split(/\s+/).filter(item => regex.test(item))[0]
    switch (circulateur){
        case 'C1':
            var label = data['trilbl(05)']
            var vitesse = data['CircType(4)']
            break;
        case 'C2':
            var label = data['trilbl(06)']
            var vitesse = data['CircType(5)']
            break;
        case 'C3':
            var label = data['trilbl(07)']
            var vitesse = data['CircType(3)']
            break;
        case 'C4':
            var label = data['trilbl(01)']
            var vitesse = data['CircType(0)']
            break;
        case 'C5':
            var label = data['trilbl(02)']
            var vitesse = data['CircType(1)']
            break;
        case 'C6':
            var label = data['trilbl(03)']
            var vitesse = data['CircType(2)']
            break;
        case 'C7':
            var label = data['trilbl(04)']
            var vitesse = data['CircType(3)']
            break;
    }
    affichageCiculateur(circulateur, label, vitesse)
})
$(".divS10Capteur").on("click", function(){affichageCiculateur("S10", data['trilbl(10)'], data['CircType(7)']), animationSelection(this)})
$(".divS11Capteur").on("click", function(){affichageCiculateur("S11", data['trilbl(11)'], data['CircType(8)']), animationSelection(this)})

$(".tampon, .zone, .appoint1, .fa-solar-panel, .T1, .T10, .T2, .T3, .T4, .T5, .T6, .T7, .T8, .T9, .T10, .T11, .T12, .T13, .T14, .T15, .T16, .C1, .C2, .C3, .C4, .C5, .C6, .C7, .divS11Capteur, .divS10Capteur").hover(
    function(){
        $(this).addClass("fa-bounce")
    },
    function(){
        if(!$(this).hasClass('selected')){
            $(this).removeClass("fa-bounce")
        }
    }
)



